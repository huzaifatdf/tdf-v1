import{J as z,r as c,S as g,j as e,Q as B}from"./app-bN2thyMN.js";import{A as K,E as L}from"./AuthenticatedLayout-DqSI4DTA.js";import{u as O,f as S,g as U,a as J,b as Q,c as $}from"./index-Cuoe6MFB.js";import{I as q,D as w,a as v,B as o,b as N,c as G,g as W,h as p,m as X}from"./breadcrumb-DG_kDHas.js";import{C as y}from"./checkbox-Cw0NTwsi.js";import{T as Y,a as Z,b as j,c as ee,d as se,e as D}from"./table-DNhQuOx6.js";import{D as ae,a as te,b as ie,c as le,d as oe,e as ne,f as re}from"./dialog-BqckQOtS.js";import{B as ce}from"./badge-DNYIKsqm.js";import{C as de}from"./chevron-down-BZKhmhW6.js";import{A as x}from"./arrow-up-down-Dgo6n7o1.js";import{E as me}from"./eye-DNf_n4JV.js";import{D as ge}from"./download-DXUYmG2W.js";import{A as ue}from"./archive-C7eO9jpH.js";import"./toast-DLvMz8uQ.js";import"./index-BoNewnr7.js";import"./toaster-eYdLjHoL.js";import"./index-Du80_tw0.js";function Te(){var C,b;const{submissions:d,formFields:he,dynamicColumns:xe,filters:k,sort:R,slug:M}=z().props,[m,I]=c.useState(R||[]),[u,A]=c.useState(k||[]),[F,P]=c.useState({}),[T,V]=c.useState({}),[h,E]=c.useState({pageIndex:d.current_page-1,pageSize:d.per_page}),f=(()=>{const a=[{id:"select",header:({table:s})=>e.jsx(y,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:t=>s.toggleAllPageRowsSelected(!!t),"aria-label":"Select all"}),cell:({row:s})=>e.jsx(y,{checked:s.getIsSelected(),onCheckedChange:t=>s.toggleSelected(!!t),"aria-label":"Select row"}),enableSorting:!1,enableHiding:!1},{accessorKey:"id",header:({column:s})=>e.jsxs(o,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["S.No",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.index+1})}],i=[{accessorKey:"value",header:({column:s})=>e.jsxs(o,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Value",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>{let t;console.log(s.original.data);try{t=s.original.data}catch{return e.jsx("div",{className:"text-red-500",children:"Invalid JSON"})}if(!t||typeof t!="object")return e.jsx("div",{className:"text-gray-500",children:"No Data"});const n=Object.entries(t).map(([r,H])=>` ${H}`).join(`,
`);return e.jsx("div",{className:"font-medium",children:n})}},{accessorKey:"Form",header:({column:s})=>e.jsxs(o,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Form",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.original.form.name})}],_=[{accessorKey:"status",header:"Status",cell:({row:s})=>{var r;const t=s.getValue("status"),n={new:"bg-blue-100 text-blue-800",read:"bg-green-100 text-green-800",archived:"bg-gray-100 text-gray-800"};return e.jsx(ce,{className:n[t]||"bg-gray-100 text-gray-800",children:((r=t==null?void 0:t.charAt(0))==null?void 0:r.toUpperCase())+(t==null?void 0:t.slice(1))||"Unknown"})}},{accessorKey:"created_at",header:({column:s})=>e.jsxs(o,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Created At",e.jsx(x,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>new Date(s.getValue("created_at")).toLocaleDateString()},{id:"actions",enableHiding:!1,cell:({row:s})=>{const t=s.original,n=t.form.slug;return e.jsxs(w,{children:[e.jsx(v,{asChild:!0,children:e.jsxs(o,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(L,{className:"h-4 w-4"})]})}),e.jsxs(N,{align:"end",children:[e.jsx(W,{children:"Actions"}),e.jsxs(p,{onClick:()=>g.get(route("form.submission.show",[n,t.id])),className:"cursor-pointer",children:[e.jsx(me,{className:"mr-2 h-4 w-4"}),"View Details"]}),e.jsxs(p,{onClick:()=>g.post(route("form.submission.export",[n,t.id])),className:"cursor-pointer",children:[e.jsx(ge,{className:"mr-2 h-4 w-4"}),"Export"]}),e.jsx(X,{}),e.jsxs(ae,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(p,{className:"cursor-pointer text-red-600",onSelect:r=>{r.preventDefault(),g.post(route("form.submission.archive",[n,t.id]),{},{onSuccess:()=>{}})},children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Archive Submission"]})}),e.jsxs(ie,{className:"sm:max-w-[425px]",children:[e.jsxs(le,{children:[e.jsx(oe,{children:"Archive Submission"}),e.jsx(ne,{children:"Are you sure you want to archive this submission? This action can be undone later."})]}),e.jsx(re,{children:e.jsx(o,{variant:"destructive",onClick:()=>{g.patch(route("dynamicform.submission.archive",[n,t.id]))},children:"Confirm Archive"})})]})]})]})]})}}];return[...a,...i,..._]})();c.useEffect(()=>{const a={};u.length>0&&(a.filters=Object.fromEntries(u.map(i=>[i.id.replace("flattened_data.",""),i.value]))),m.length>0&&(a.sort={key:m[0].id.replace("flattened_data.",""),order:m[0].desc?"desc":"asc"}),a.page=h.pageIndex+1,a.perPage=h.pageSize,g.get(route("form.submission.index",M),a,{preserveState:!0,replace:!0})},[u,m,h]);const l=O({data:d.data,columns:f,pageCount:d.last_page,state:{sorting:m,columnFilters:u,columnVisibility:F,rowSelection:T,pagination:h},onSortingChange:I,onColumnFiltersChange:A,onColumnVisibilityChange:P,onRowSelectionChange:V,onPaginationChange:E,getCoreRowModel:$(),getPaginationRowModel:Q(),getSortedRowModel:J(),getFilteredRowModel:U(),manualPagination:!0,manualSorting:!0,manualFiltering:!0});return e.jsxs(K,{children:[e.jsx(B,{title:"Submissions"}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsx("div",{className:"@container/main flex flex-1 flex-col gap-2 p-10",children:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"mb-4",children:e.jsx("h1",{className:"text-2xl font-bold",children:" Submissions"})}),e.jsxs("div",{className:"flex items-center py-4 gap-4",children:[e.jsx(q,{placeholder:"Filter by ID...",value:((C=l.getColumn("id"))==null?void 0:C.getFilterValue())??"",onChange:a=>{var i;return(i=l.getColumn("id"))==null?void 0:i.setFilterValue(a.target.value)},className:"max-w-sm"}),e.jsxs(w,{children:[e.jsx(v,{asChild:!0,children:e.jsxs(o,{variant:"outline",className:"ml-auto",children:["Columns ",e.jsx(de,{className:"ml-2 h-4 w-4"})]})}),e.jsx(N,{align:"end",children:l.getAllColumns().filter(a=>a.getCanHide()).map(a=>e.jsx(G,{className:"capitalize",checked:a.getIsVisible(),onCheckedChange:i=>a.toggleVisibility(!!i),children:a.id.replace("flattened_data.","")},a.id))})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(Y,{children:[e.jsx(Z,{children:l.getHeaderGroups().map(a=>e.jsx(j,{children:a.headers.map(i=>e.jsx(ee,{children:i.isPlaceholder?null:S(i.column.columnDef.header,i.getContext())},i.id))},a.id))}),e.jsx(se,{children:(b=l.getRowModel().rows)!=null&&b.length?l.getRowModel().rows.map(a=>e.jsx(j,{"data-state":a.getIsSelected()&&"selected",children:a.getVisibleCells().map(i=>e.jsx(D,{children:S(i.column.columnDef.cell,i.getContext())},i.id))},a.id)):e.jsx(j,{children:e.jsx(D,{colSpan:f.length,className:"h-24 text-center",children:"No submissions found."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsxs("div",{className:"space-x-2",children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>l.previousPage(),disabled:!l.getCanPreviousPage(),children:"Previous"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>l.nextPage(),disabled:!l.getCanNextPage(),children:"Next"})]}),e.jsxs("div",{className:"flex-1 text-sm text-muted-foreground",children:[l.getFilteredSelectedRowModel().rows.length," of"," ",d.total," row(s) selected."]})]})]})})})]})}export{Te as default};
