import{q as K,r,m as p,j as e,$ as U}from"./app-FiqTlAuv.js";import{A as O,E as q}from"./AuthenticatedLayout-CKICmM05.js";import{u as Y,T as G,a as J,b as C,c as Q,f as D,d as W,e as k,A as f,g as X,h as Z,i as ee,j as se}from"./table-BYLMW66P.js";import{i as M,D as R,j as F,B as n,k as I,l as ae,m as te,n as b,o as le}from"./toast-CYu977no.js";import{C as P}from"./checkbox-B3DeHUp2.js";import{D as ie,a as ne,b as oe,c as re,d as ce,e as de,f as me}from"./dialog-CaustJjC.js";import{B as w}from"./badge-1ACIsTwd.js";import{C as ge}from"./chevron-down-dvWM5iFe.js";import{E as he}from"./eye-Bvk9s3gl.js";import{D as ue}from"./download-XetZ2Khl.js";import{c as xe}from"./createLucideIcon-BnawVl-O.js";import"./index-C5iOmN6S.js";import"./index-Bm5b80rQ.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]],je=xe("archive",pe);function Ve(){var S,N,y;const{submissions:c,form:j,formFields:d,dynamicColumns:Ce,filters:V,sort:A,slug:h}=K().props,[m,_]=r.useState(A||[]),[u,T]=r.useState(V||[]),[E,H]=r.useState({}),[$,z]=r.useState({}),[x,B]=r.useState({pageIndex:c.current_page-1,pageSize:c.per_page}),v=(()=>{const a=[{id:"select",header:({table:s})=>e.jsx(P,{checked:s.getIsAllPageRowsSelected()||s.getIsSomePageRowsSelected()&&"indeterminate",onCheckedChange:l=>s.toggleAllPageRowsSelected(!!l),"aria-label":"Select all"}),cell:({row:s})=>e.jsx(P,{checked:s.getIsSelected(),onCheckedChange:l=>s.toggleSelected(!!l),"aria-label":"Select row"}),enableSorting:!1,enableHiding:!1},{accessorKey:"id",header:({column:s})=>e.jsxs(n,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["ID",e.jsx(f,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>e.jsx("div",{className:"font-medium",children:s.getValue("id")})}],t=d.map(s=>({accessorKey:`flattened_data.${s.name}`,header:({column:l})=>e.jsxs(n,{variant:"ghost",onClick:()=>l.toggleSorting(l.getIsSorted()==="asc"),children:[s.label,e.jsx(f,{className:"ml-2 h-4 w-4"})]}),cell:({row:l})=>{var g;const o=(g=l.original.flattened_data)==null?void 0:g[s.name];return s.type==="file"&&o?e.jsx(n,{variant:"link",size:"sm",children:"View File"}):s.type==="checkbox"?o?e.jsx(w,{variant:"secondary",children:"Yes"}):e.jsx(w,{variant:"outline",children:"No"}):e.jsx("div",{className:"max-w-[200px] truncate",children:o||"-"})}})),L=[{accessorKey:"status",header:"Status",cell:({row:s})=>{var g;const l=s.getValue("status"),o={new:"bg-blue-100 text-blue-800",read:"bg-green-100 text-green-800",archived:"bg-gray-100 text-gray-800"};return e.jsx(w,{className:o[l]||"bg-gray-100 text-gray-800",children:((g=l==null?void 0:l.charAt(0))==null?void 0:g.toUpperCase())+(l==null?void 0:l.slice(1))||"Unknown"})}},{accessorKey:"created_at",header:({column:s})=>e.jsxs(n,{variant:"ghost",onClick:()=>s.toggleSorting(s.getIsSorted()==="asc"),children:["Created At",e.jsx(f,{className:"ml-2 h-4 w-4"})]}),cell:({row:s})=>new Date(s.getValue("created_at")).toLocaleDateString()},{id:"actions",enableHiding:!1,cell:({row:s})=>{const l=s.original;return e.jsxs(R,{children:[e.jsx(F,{asChild:!0,children:e.jsxs(n,{variant:"ghost",className:"h-8 w-8 p-0",children:[e.jsx("span",{className:"sr-only",children:"Open menu"}),e.jsx(q,{className:"h-4 w-4"})]})}),e.jsxs(I,{align:"end",children:[e.jsx(te,{children:"Actions"}),e.jsxs(b,{onClick:()=>p.get(route("dynamicform.submission.show",[h,l.id])),className:"cursor-pointer",children:[e.jsx(he,{className:"mr-2 h-4 w-4"}),"View Details"]}),e.jsxs(b,{onClick:()=>p.post(route("dynamicform.submission.export",[h,l.id])),className:"cursor-pointer",children:[e.jsx(ue,{className:"mr-2 h-4 w-4"}),"Export"]}),e.jsx(le,{}),e.jsxs(ie,{children:[e.jsx(ne,{asChild:!0,children:e.jsxs(b,{className:"cursor-pointer text-red-600",onSelect:o=>o.preventDefault(),children:[e.jsx(je,{className:"mr-2 h-4 w-4"}),"Archive Submission"]})}),e.jsxs(oe,{className:"sm:max-w-[425px]",children:[e.jsxs(re,{children:[e.jsx(ce,{children:"Archive Submission"}),e.jsx(de,{children:"Are you sure you want to archive this submission? This action can be undone later."})]}),e.jsx(me,{children:e.jsx(n,{variant:"destructive",onClick:()=>{p.patch(route("dynamicform.submission.archive",[h,l.id]))},children:"Confirm Archive"})})]})]})]})]})}}];return[...a,...t,...L]})();r.useEffect(()=>{const a={};u.length>0&&(a.filters=Object.fromEntries(u.map(t=>[t.id.replace("flattened_data.",""),t.value]))),m.length>0&&(a.sort={key:m[0].id.replace("flattened_data.",""),order:m[0].desc?"desc":"asc"}),a.page=x.pageIndex+1,a.perPage=x.pageSize,p.get(route("form.submission.index",h),a,{preserveState:!0,replace:!0})},[u,m,x]);const i=Y({data:c.data,columns:v,pageCount:c.last_page,state:{sorting:m,columnFilters:u,columnVisibility:E,rowSelection:$,pagination:x},onSortingChange:_,onColumnFiltersChange:T,onColumnVisibilityChange:H,onRowSelectionChange:z,onPaginationChange:B,getCoreRowModel:se(),getPaginationRowModel:ee(),getSortedRowModel:Z(),getFilteredRowModel:X(),manualPagination:!0,manualSorting:!0,manualFiltering:!0});return e.jsxs(O,{children:[e.jsx(U,{title:`${j.name} - Submissions`}),e.jsx("div",{className:"flex flex-1 flex-col",children:e.jsx("div",{className:"@container/main flex flex-1 flex-col gap-2 p-10",children:e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("h1",{className:"text-2xl font-bold",children:[j.name," Submissions"]}),e.jsx("p",{className:"text-gray-600",children:j.description})]}),e.jsxs("div",{className:"flex items-center py-4 gap-4",children:[e.jsx(M,{placeholder:"Filter by ID...",value:((S=i.getColumn("id"))==null?void 0:S.getFilterValue())??"",onChange:a=>{var t;return(t=i.getColumn("id"))==null?void 0:t.setFilterValue(a.target.value)},className:"max-w-sm"}),d.length>0&&e.jsx(M,{placeholder:`Filter by ${d[0].label}...`,value:((N=i.getColumn(`flattened_data.${d[0].name}`))==null?void 0:N.getFilterValue())??"",onChange:a=>{var t;return(t=i.getColumn(`flattened_data.${d[0].name}`))==null?void 0:t.setFilterValue(a.target.value)},className:"max-w-sm"}),e.jsxs(R,{children:[e.jsx(F,{asChild:!0,children:e.jsxs(n,{variant:"outline",className:"ml-auto",children:["Columns ",e.jsx(ge,{className:"ml-2 h-4 w-4"})]})}),e.jsx(I,{align:"end",children:i.getAllColumns().filter(a=>a.getCanHide()).map(a=>e.jsx(ae,{className:"capitalize",checked:a.getIsVisible(),onCheckedChange:t=>a.toggleVisibility(!!t),children:a.id.replace("flattened_data.","")},a.id))})]})]}),e.jsx("div",{className:"rounded-md border",children:e.jsxs(G,{children:[e.jsx(J,{children:i.getHeaderGroups().map(a=>e.jsx(C,{children:a.headers.map(t=>e.jsx(Q,{children:t.isPlaceholder?null:D(t.column.columnDef.header,t.getContext())},t.id))},a.id))}),e.jsx(W,{children:(y=i.getRowModel().rows)!=null&&y.length?i.getRowModel().rows.map(a=>e.jsx(C,{"data-state":a.getIsSelected()&&"selected",children:a.getVisibleCells().map(t=>e.jsx(k,{children:D(t.column.columnDef.cell,t.getContext())},t.id))},a.id)):e.jsx(C,{children:e.jsx(k,{colSpan:v.length,className:"h-24 text-center",children:"No submissions found."})})})]})}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 py-4",children:[e.jsxs("div",{className:"flex-1 text-sm text-muted-foreground",children:[i.getFilteredSelectedRowModel().rows.length," of"," ",c.total," row(s) selected."]}),e.jsxs("div",{className:"space-x-2",children:[e.jsx(n,{variant:"outline",size:"sm",onClick:()=>i.previousPage(),disabled:!i.getCanPreviousPage(),children:"Previous"}),e.jsx(n,{variant:"outline",size:"sm",onClick:()=>i.nextPage(),disabled:!i.getCanNextPage(),children:"Next"})]})]})]})})})]})}export{Ve as default};
